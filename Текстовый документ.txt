<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–π—Å –§—å—é–º–∏–∫–∞</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            /* –¶–≤–µ—Ç–∞ –ø–æ–¥ Telegram-—Ç–µ–º—É */
            --bg: var(--tg-theme-bg-color, #b3e5fc);
            --text: var(--tg-theme-text-color, #000000);
            --card: #ffffff;
            --accent: #0288d1;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #game-box {
            width: 95%;
            max-width: 450px;
            background: var(--card);
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border: 3px solid var(--accent);
        }

        .header h2 {
            margin: 0;
            color: #01579b;
            font-size: 20px;
        }

        .header p {
            margin: 4px 0 0;
            color: #546e7a;
            font-size: 14px;
        }

        .runway {
            width: 100%;
            height: 130px;
            background: #90a4ae;
            border-radius: 18px;
            position: relative;
            overflow: hidden;
            border-bottom: 6px dashed white;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding: 8px 10px 10px;
            box-sizing: border-box;
        }

        .cloud {
            position: absolute;
            color: white;
            font-size: 26px;
            animation: fly 12s linear infinite;
            opacity: 0.6;
        }

        @keyframes fly {
            from { left: -60px; }
            to   { left: 480px; }
        }

        #hero {
            font-size: 40px;
            position: relative;
            transition: 0.5s ease-out;
            z-index: 5;
        }

        #target {
            font-size: 40px;
        }

        .fuel-container {
            background: #e0e0e0;
            height: 18px;
            border-radius: 10px;
            margin: 12px 0;
            overflow: hidden;
            border: 2px solid #546e7a;
        }

        #fuel-level {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, #ff8f00, #ffca28);
            transition: 0.3s;
        }

        .math-card {
            background: #f1f8e9;
            border: 2px solid #8bc34a;
            border-radius: 18px;
            padding: 14px;
            margin: 14px 0;
        }

        #question {
            font-size: 26px;
            color: #2e7d32;
            font-weight: bold;
            text-align: center;
        }

        #phrase {
            font-size: 14px;
            color: #455a64;
            margin-top: 6px;
            text-align: center;
            min-height: 18px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 8px;
        }

        button.answer {
            background: #03a9f4;
            color: white;
            border: none;
            padding: 12px;
            font-size: 18px;
            border-radius: 14px;
            cursor: pointer;
            box-shadow: 0 3px #0288d1;
            transition: 0.1s;
        }

        button.answer:hover {
            background: #29b6f6;
        }

        button.answer:active {
            box-shadow: 0 0;
            transform: translateY(3px);
        }

        .bottom-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 13px;
            color: #607d8b;
        }

        .top-buttons {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 6px;
            gap: 6px;
        }

        .small-btn {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            background: #eceff1;
            color: #455a64;
        }
    </style>
</head>
<body>
<div id="game-box">
    <div class="top-buttons">
        <button class="small-btn" onclick="restartGame()">üîÅ –°–Ω–∞—á–∞–ª–∞</button>
        <button class="small-btn" onclick="closeApp()">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div class="header">
        <h2>‚úàÔ∏è –†–µ–π—Å –§—å—é–º–∏–∫–∞</h2>
        <p>–ü–æ–º–æ–≥–∏ –§—å—é–º–∏–∫—É, –§–∞–Ω—Ç–∏–∫—É –∏ –ü—ã—à–∫–∏–Ω—É –¥–æ–ª–µ—Ç–µ—Ç—å –¥–æ —Ñ–∏–Ω–∏—à–∞!</p>
    </div>

    <div class="runway">
        <div class="cloud" style="top:10%; animation-duration: 15s;">‚òÅÔ∏è</div>
        <div class="cloud" style="top:35%; animation-duration: 11s;">‚òÅÔ∏è</div>

        <!-- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É –§—å—é–º–∏–∫–∞ -->
        <div id="hero">üêà‚Äç‚¨õ</div>
        <div id="target">üèÅ</div>
    </div>

    <div class="fuel-container">
        <div id="fuel-level"></div>
    </div>

    <div class="math-card">
        <div id="question">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="phrase"></div>
    </div>

    <div class="grid" id="answers">
        <button class="answer"></button>
        <button class="answer"></button>
        <button class="answer"></button>
        <button class="answer"></button>
    </div>

    <div class="bottom-bar">
        <div id="step-info">–ó–∞–¥–∞—á–∞: 1 / 5</div>
        <div id="fuel-info">–¢–æ–ø–ª–∏–≤–æ: 100%</div>
    </div>
</div>

<script>
    const tg = window.Telegram ? window.Telegram.WebApp : null;
    if (tg) {
        tg.expand();
    }

    let step = 0;
    const goal = 5;          // –∫–æ—Ä–æ—Ç–∫–∞—è –∏–≥—Ä–∞: 5 –∑–∞–¥–∞—á
    let fuel = 100;
    let correctValue = null;

    const hero = document.getElementById('hero');
    const fuelBar = document.getElementById('fuel-level');
    const questionEl = document.getElementById('question');
    const phraseEl = document.getElementById('phrase');
    const stepInfo = document.getElementById('step-info');
    const fuelInfo = document.getElementById('fuel-info');
    const buttons = document.querySelectorAll('#answers button');

    const phrasesCorrect = [
        '–§—å—é–º–∏–∫ –º—É—Ä–ª—ã—á–µ—Ç: –∫—É—Ä—Å –≤–µ—Ä–Ω—ã–π!',
        '–§–∞–Ω—Ç–∏–∫ —Ä–∞–¥–æ—Å—Ç–Ω–æ –º–∞—à–µ—Ç –∫—Ä—ã–ª—å—è–º–∏!',
        '–ü—ã—à–∫–∏–Ω –Ω–µ —É—Ä–æ–Ω–∏–ª –∫–µ–∫—Å ‚Äî —á—É–¥–æ!',
        '–≠–∫–∏–ø–∞–∂ –¥–æ–≤–æ–ª–µ–Ω —Ç–≤–æ–∏–º–∏ —Ä–∞—Å—á—ë—Ç–∞–º–∏!',
        '–¢—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–∏–ª–æ—Ç–∞!'
    ];

    const phrasesWrong = [
        '–§—å—é–º–∏–∫ —Å–ø–æ–∫–æ–π–Ω–æ: –Ω–∏—á–µ–≥–æ, –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º.',
        '–§–∞–Ω—Ç–∏–∫ —à–µ–ø—á–µ—Ç: –∫–∞–∂–µ—Ç—Å—è, —Ç—É—Ç –æ—à–∏–±–∫–∞‚Ä¶',
        '–ü—ã—à–∫–∏–Ω —Ä–æ–Ω—è–µ—Ç –∫–µ–∫—Å: –æ–π‚Ä¶ —ç—Ç–æ —è?',
        '–°–∞–º–æ–ª—ë—Ç —Å–ª–µ–≥–∫–∞ —Ç—Ä—è—Ö–Ω—É–ª–æ, –Ω–æ –≤—Å—ë –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.',
        '–û–±–ª–∞–∫–∞ –∑–∞–ø—É—Ç–∞–ª–∏, –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑!'
    ];

    function updateUI() {
        stepInfo.textContent = '–ó–∞–¥–∞—á–∞: ' + (step + 1) + ' / ' + goal;
        fuelInfo.textContent = '–¢–æ–ø–ª–∏–≤–æ: ' + fuel + '%';
        fuelBar.style.width = fuel + '%';

        const maxShift = 220; // –ø–∏–∫—Å–µ–ª–µ–π –¥–æ —Ñ–∏–Ω–∏—à–∞
        const progress = step / goal;
        hero.style.transform = 'translateX(' + (maxShift * progress) + 'px)';
    }

    function randomFrom(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }

    function makeQuestion() {
        if (step >= goal) {
            endGame();
            return;
        }

        phraseEl.textContent = '';

        const isMult = Math.random() > 0.5;
        if (isMult) {
            const a = Math.floor(Math.random() * 8) + 2;
            const b = Math.floor(Math.random() * 8) + 2;
            correctValue = a * b;
            questionEl.textContent = a + ' √ó ' + b + ' = ?';
        } else {
            const a = Math.floor(Math.random() * 400) + 50;
            const b = Math.floor(Math.random() * 300) + 50;
            correctValue = a + b;
            questionEl.textContent = a + ' + ' + b + ' = ?';
        }

        let options = [correctValue];
        while (options.length < 4) {
            let fake = correctValue + (Math.floor(Math.random() * 20) - 10);
            if (fake > 0 && !options.includes(fake)) {
                options.push(fake);
            }
        }
        options.sort(() => Math.random() - 0.5);

        buttons.forEach((btn, i) => {
            const val = options[i];
            btn.textContent = val;
            btn.onclick = () => checkAnswer(val);
        });

        updateUI();
    }

    function checkAnswer(val) {
        if (val === correctValue) {
            step++;
            fuel = Math.min(100, fuel + 10);
            phraseEl.textContent = randomFrom(phrasesCorrect);
            makeQuestion();
        } else {
            fuel -= 25;
            phraseEl.textContent = randomFrom(phrasesWrong);
            if (fuel <= 0) {
                fuel = 0;
                gameOver();
                return;
            }
            updateUI();
        }
    }

    function gameOver() {
        document.getElementById('game-box').innerHTML = `
            <h2>üõ¨ –ó–∞–ø–∞—Å–Ω–æ–π –∞—ç—Ä–æ–¥—Ä–æ–º</h2>
            <p>–¢–æ–ø–ª–∏–≤–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å, –Ω–æ –§—å—é–º–∏–∫ –ø–æ—Å–∞–¥–∏–ª —Å–∞–º–æ–ª—ë—Ç –º—è–≥–∫–æ –∏ —Å–ø–æ–∫–æ–π–Ω–æ.</p>
            <p>–§–∞–Ω—Ç–∏–∫ –º–∞—à–µ—Ç –∫—Ä—ã–ª—å—è–º–∏: "–î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â—ë —Ä–∞–∑!"</p>
            <button class="answer" onclick="restartGame()">üîÅ –ù–æ–≤—ã–π –ø–æ–ª—ë—Ç</button>
        `;
    }

    function endGame() {
        const result = {
            type: 'flight_result',
            tasks: goal,
            fuel: fuel
        };

        document.getElementById('game-box').innerHTML = `
            <h2>üéâ –ü–æ—Å–∞–¥–∫–∞ —É–¥–∞–ª–∞—Å—å!</h2>
            <p>–¢—ã –ø–æ–º–æ–≥ –§—å—é–º–∏–∫—É, –§–∞–Ω—Ç–∏–∫—É –∏ –ü—ã—à–∫–∏–Ω—É —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–π—Å.</p>
            <p>–ü—ã—à–∫–∏–Ω –≤—Ä—É—á–∞–µ—Ç —Ç–µ–±–µ –∫–µ–∫—Å-–º–µ–¥–∞–ª—å –∑–∞ –æ—Ç–≤–∞–≥—É –∏ —Å–º–µ–∫–∞–ª–∫—É!</p>
            <button class="answer" onclick="restartGame()">üîÅ –ï—â—ë –æ–¥–∏–Ω –ø–æ–ª—ë—Ç</button>
        `;

        if (tg) {
            tg.sendData(JSON.stringify(result));
        }
    }

    function restartGame() {
        location.reload();
    }

    function closeApp() {
        if (tg) {
            tg.close();
        } else {
            // –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
            alert('–í Telegram WebApp –æ–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –∞ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É.');
        }
    }

    // —Å—Ç–∞—Ä—Ç
    makeQuestion();
</script>
</body>
</html>